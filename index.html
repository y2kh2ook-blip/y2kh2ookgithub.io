<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardVerse - Phygital Game Card</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #ecf0f1;
        }
        .screen {
            display: none;
        }
        .active-nav {
            opacity: 100% !important;
            transform: translateY(-4px);
            transition: transform 0.2s;
        }
        .logo-text {
            font-size: 3rem;
            font-weight: 700;
            color: #ecf0f1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 2px;
        }

        /* --- Gameplay CSS --- */
        .game-board {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            height: 100vh;
            padding: 20px;
            background-image: url('https://i.ibb.co/Ctnz3Yg/card-background.png');
            background-size: cover;
            background-position: center;
        }
        .player-area, .opponent-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .board, .hand {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            min-height: 120px;
            padding: 10px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            width: 100%;
        }
        .card {
            width: 100px;
            height: 140px;
            background-color: rgba(36, 41, 46, 0.8);
            border: 2px solid #555;
            border-radius: 8px;
            padding: 5px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .card.active {
            border-color: #3498db;
            box-shadow: 0 0 10px #3498db;
        }
        .card h4 {
            font-size: 0.9rem;
            margin: 5px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .stats {
            font-size: 0.8rem;
            color: #ccc;
        }
        .actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        .action-btn {
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .action-btn:hover {
            background-color: #34495e;
        }
        .action-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        .life-bar {
            background-color: #e74c3c;
            height: 10px;
            border-radius: 5px;
            transition: width 0.5s;
        }
        .life-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            width: 100%;
            max-width: 300px;
        }
        .log-container {
            position: absolute;
            bottom: 70px;
            left: 20px;
            right: 20px;
            background-color: rgba(22, 27, 34, 0.8);
            border-radius: 8px;
            padding: 10px;
            height: 80px;
            overflow-y: scroll;
        }
        .log-container p {
            margin: 0;
            font-size: 0.8rem;
            line-height: 1.4;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <div id="login-screen" class="screen flex items-center justify-center p-4">
        <div class="bg-gray-800 p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-md mx-4 text-center">
            <div class="mb-8">
                <div class="w-24 h-24 bg-gray-700 rounded-full mx-auto flex items-center justify-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 12l10 10 10-10L12 2zm0 18.83L3.17 12 12 3.17 20.83 12 12 20.83zM12 14c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                </div>
                <h1 class="logo-text">CardVerse</h1>
                <p class="text-gray-400 mt-2">Phygital Game Card</p>
            </div>
            <div class="space-y-4 mb-8">
                <button class="flex items-center justify-center w-full py-3 px-4 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl shadow-md transition-colors">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21.35 12.04c0-.79-.07-1.54-.18-2.29H12v4.32h4.94a5.15 5.15 0 01-2.23 3.37v2.8h3.6c2.1-1.94 3.32-4.8 3.32-8.3z"/><path d="M12 20.01c-3.14 0-5.83-1.74-7.29-4.32l3.6-2.8c.84.58 1.96.93 3.69.93 1.83 0 3.35-.6 4.62-1.63L18.4 17.5c-1.3 1.25-3.08 2.01-5.11 2.01z"/><path d="M4.71 12c0-1.02.2-1.98.54-2.86l-3.6-2.8c-.85 1.77-1.33 3.79-1.33 5.66s.48 3.89 1.33 5.66l3.6-2.8c-.34-.88-.54-1.84-.54-2.86z"/><path d="M12 4.01c1.92 0 3.53.64 4.62 1.63L20.21 2c-1.26-1.18-2.94-1.9-4.9-1.9-2.73 0-5.13 1.08-6.93 2.86l3.6 2.8c.95-.58 2.07-.93 3.53-.93z"/></svg>
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google
                </button>
                <button class="flex items-center justify-center w-full py-3 px-4 bg-blue-700 hover:bg-blue-800 text-white font-semibold rounded-xl shadow-md transition-colors">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M22.675 0H1.325C.593 0 0 .593 0 1.325v21.35C0 23.407.593 24 1.325 24h11.233V14.734h-3.834v-4.42h3.834V7.237c0-3.805 2.327-5.875 5.705-5.875 1.624 0 3.02.12 3.424.175v3.944l-2.336.001c-1.835 0-2.187.873-2.187 2.152v2.812h4.373l-.57 4.42h-3.803V24h6.006c.732 0 1.325-.593 1.325-1.325V1.325C24 .593 23.407 0 22.675 0z"/></svg>
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Facebook
                </button>
            </div>
            <div class="relative flex items-center mb-6">
                <div class="flex-grow border-t border-gray-700"></div>
                <span class="flex-shrink mx-4 text-gray-500 text-sm">‡∏´‡∏£‡∏∑‡∏≠</span>
                <div class="flex-grow border-t border-gray-700"></div>
            </div>
            <form id="login-form">
                <div class="space-y-4">
                    <input type="text" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full px-4 py-3 bg-gray-700 text-white border border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full px-4 py-3 bg-gray-700 text-white border border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" class="w-full mt-6 py-3 px-4 bg-gray-900 hover:bg-gray-700 text-white font-semibold rounded-xl shadow-md transition-colors">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
            <div class="mt-6 text-gray-400 text-sm">
                <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?</span>
                <a href="#" class="text-blue-500 hover:text-blue-400 font-semibold">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>
            </div>
        </div>
    </div>
    
    <div id="home-screen" class="screen flex-1 flex flex-col items-center justify-center p-4">
        <h1 class="logo-text mb-8">CardVerse</h1>
        <div class="grid grid-cols-2 gap-6 w-full max-w-lg">
            <button id="nav-battle" class="bg-blue-600 hover:bg-blue-700 text-white py-8 px-4 rounded-xl shadow-lg transition-transform hover:scale-105 font-bold text-xl">
                ‚öîÔ∏è Battle
            </button>
            <button id="nav-deck" class="bg-green-600 hover:bg-green-700 text-white py-8 px-4 rounded-xl shadow-lg transition-transform hover:scale-105 font-bold text-xl">
                üÉè Deck Builder
            </button>
            <button id="nav-market" class="bg-purple-600 hover:bg-purple-700 text-white py-8 px-4 rounded-xl shadow-lg transition-transform hover:scale-105 font-bold text-xl">
                üõí Marketplace
            </button>
            <button id="nav-wallet" class="bg-amber-600 hover:bg-amber-700 text-white py-8 px-4 rounded-xl shadow-lg transition-transform hover:scale-105 font-bold text-xl">
                üí≥ Wallet
            </button>
            <button id="nav-lore" class="bg-gray-600 hover:bg-gray-700 text-white py-8 px-4 rounded-xl shadow-lg transition-transform hover:scale-105 font-bold text-xl col-span-2">
                üìñ Lore/Story
            </button>
        </div>
    </div>

    <div id="collection-screen" class="screen flex-1 flex flex-col font-inter">
        <header class="p-4 bg-gray-900 text-white shadow-lg text-center">
            <h1 class="text-xl font-bold">‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏Å‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
        </header>
        <main id="card-grid" class="flex-grow p-4 pb-20 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            <div id="loading-message" class="col-span-full text-center text-gray-500 mt-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î...</div>
        </main>
        <button id="scan-button-collection" class="fixed bottom-24 right-4 z-50 p-4 bg-gray-900 text-white rounded-full shadow-2xl flex items-center justify-center transform transition-transform hover:scale-110">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scan"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M17 21h2a2 2 0 0 0 2-2v-2"/><path d="M3 17v2a2 2 0 0 0 2 2h2"/></svg>
        </button>
        <div id="card-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50" style="display: none;">
            <div class="bg-gray-900 bg-opacity-80 text-white p-6 rounded-2xl shadow-lg border border-gray-300 w-full max-w-sm relative">
                <button id="close-modal" class="absolute top-3 right-3 text-yellow-500 hover:text-yellow-900">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
                <div id="modal-content" class="text-center"></div>
            </div>
        </div>
    </div>

    <div id="battle-screen" class="screen flex-1 flex flex-col items-center justify-center p-4 game-board">
        <div class="opponent-area">
            <div class="life-info">
                <span class="text-white text-xl font-bold">Player B</span>
                <div class="flex-grow bg-gray-500 rounded-full h-2.5">
                    <div id="opponent-life-bar" class="life-bar" style="width: 100%;"></div>
                </div>
                <span id="opponent-life" class="text-white text-xl">15</span>
            </div>
            <div id="opponent-board" class="board">
                <p class="text-gray-400">Opponent's Board</p>
            </div>
        </div>

        <div class="flex flex-col items-center justify-center gap-4 my-auto">
            <div id="game-status" class="text-2xl font-bold text-yellow-400"></div>
            <div class="actions">
                <button id="end-turn-btn" class="action-btn">‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô</button>
            </div>
        </div>
        
        <div class="player-area">
            <div id="player-board" class="board">
                <p class="text-gray-400">Your Board</p>
            </div>
            <div id="player-hand" class="hand">
                <p class="text-gray-400">Your Hand</p>
            </div>
            <div class="life-info">
                <span class="text-white text-xl font-bold">Player A</span>
                <div class="flex-grow bg-gray-500 rounded-full h-2.5">
                    <div id="player-life-bar" class="life-bar" style="width: 100%;"></div>
                </div>
                <span id="player-life" class="text-white text-xl">15</span>
            </div>
        </div>
        <div id="log" class="log-container">
            <p>--- Game Log ---</p>
        </div>
    </div>

    <div id="deck-builder-screen" class="screen flex-1 flex flex-col p-4">
        <h1 class="text-3xl font-bold text-white mb-4">üÉè ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏î‡πá‡∏Ñ</h1>
        <div class="flex-1 flex space-x-4">
            <div class="flex-1 bg-gray-800 p-4 rounded-xl shadow-lg overflow-y-auto">
                <h2 class="text-xl font-semibold mb-4">‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-2" id="card-collection-display">
                    <div class="text-center text-gray-500 mt-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                </div>
            </div>
            <div class="w-1/3 bg-gray-800 p-4 rounded-xl shadow-lg flex flex-col">
                <h2 class="text-xl font-semibold mb-4">‡πÄ‡∏î‡πá‡∏Ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (<span id="deck-count">0</span>/40)</h2>
                <div class="flex-1 bg-gray-700 p-2 rounded-lg overflow-y-auto" id="deck-area">
                    <p class="text-center text-gray-500 text-sm mt-4">‡∏•‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                </div>
            </div>
        </div>
    </div>

    <div id="marketplace-screen" class="screen flex-1 flex flex-col p-4">
        <h1 class="text-3xl font-bold text-white mb-4">üõí ‡∏ï‡∏•‡∏≤‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢ NFT</h1>
        <p class="text-gray-400 mb-6">‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î NFT ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</p>
        <div class="flex-1 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="market-cards">
            <div class="text-center text-gray-500 mt-8 col-span-full">‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
        </div>
    </div>

    <div id="wallet-screen" class="screen flex-1 flex flex-col p-4">
        <h1 class="text-3xl font-bold text-white mb-4">üí≥ Wallet & ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h1>
        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</h2>
            <p class="text-4xl font-bold text-yellow-500">1,250 <span class="text-base text-gray-400">Token</span></p>
        </div>
        <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-semibold mb-2">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
            <p class="text-gray-400">‡∏≠‡∏ß‡∏ï‡∏≤‡∏£: <span class="text-white">‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏ó‡∏±‡∏Å‡∏©‡πå‡∏à‡∏±‡∏Å‡∏£‡∏ß‡∏≤‡∏•</span></p>
            <p class="text-gray-400">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö: <span class="text-white">Diamond I</span></p>
            <p class="text-gray-400">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <span class="text-white">5</span></p>
        </div>
    </div>

    <div id="lore-screen" class="screen flex-1 flex flex-col p-4">
        <h1 class="text-3xl font-bold text-white mb-4">üìñ ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</h1>
        <p class="text-gray-400 mb-6">‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏Å‡∏£‡∏ß‡∏≤‡∏• CardVerse</p>
        <div class="flex-1 bg-gray-800 p-6 rounded-xl shadow-lg flex items-center justify-center">
            <p class="text-center text-gray-500">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
        </div>
    </div>

    <div id="nfc-screen" class="screen flex items-center justify-center p-4">
        <div class="bg-gray-800 p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-lg text-center space-y-6">
            <h1 class="text-3xl font-bold text-white">CardVerse PoC: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö NFC</h1>
            <p class="text-gray-400">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏¥‡∏õ NFC</p>
            <div class="space-y-4">
                <input type="text" id="serialNumberInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Serial Number" class="w-full px-4 py-3 bg-gray-700 text-white border border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="submitSerialButton" class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-md transition-colors">
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏î‡πâ‡∏ß‡∏¢ Serial Number
                </button>
            </div>
            <div class="relative flex items-center mt-6 mb-6">
                <div class="flex-grow border-t border-gray-700"></div>
                <span class="flex-shrink mx-4 text-gray-500 text-sm">‡∏´‡∏£‡∏∑‡∏≠</span>
                <div class="flex-grow border-t border-gray-700"></div>
            </div>
            <button id="scan-button-nfc" class="w-full py-4 px-6 bg-gray-900 text-white font-semibold rounded-xl shadow-lg hover:bg-gray-700 transition-colors">
                ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î
            </button>
            <div id="messageBox" class="hidden p-4 rounded-xl text-center text-sm font-medium" role="alert"></div>
            <div id="cardDisplay" class="hidden p-6 bg-gray-700 rounded-xl text-left border-2 border-dashed border-gray-600">
                <h2 class="text-xl font-bold text-white mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ</h2>
                <div id="cardInfo" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <nav id="main-nav" class="fixed bottom-0 left-0 right-0 bg-gray-900 shadow-2xl z-40" style="display: none;">
        <div class="flex justify-around items-center h-16">
            <div id="nav-home-main" class="flex flex-col items-center text-white opacity-50 cursor-pointer hover:opacity-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span class="text-xs mt-1">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
            </div>
            <div id="nav-collection-main" class="flex flex-col items-center text-white opacity-50 cursor-pointer hover:opacity-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-grid"><rect width="18" height="18" x="3" y="3" rx="2"/></svg>
                <span class="text-xs mt-1">‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏Å‡∏ä‡∏±‡∏ô</span>
            </div>
            <div id="nav-store-main" class="flex flex-col items-center text-white opacity-50 cursor-pointer hover:opacity-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-store"><path d="m14 16v-4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v4"/><path d="M22 7H2"/><path d="M22 13H2"/><path d="M12 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/><path d="M12 3v4a3 3 0 0 0-3 3v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2a3 3 0 0 0-3-3V3"/></svg>
                <span class="text-xs mt-1">‡∏ï‡∏•‡∏≤‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</span>
            </div>
            <div id="nav-profile-main" class="flex flex-col items-center text-white opacity-50 cursor-pointer hover:opacity-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <span class="text-xs mt-1">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span>
            </div>
        </div>
    </nav>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCef_Xm2vxmaLuZodymWb3tV4mbETvASgw",
  authDomain: "cardverse-mvp.firebaseapp.com",
  projectId: "cardverse-mvp",
  storageBucket: "cardverse-mvp.firebasestorage.app",
  messagingSenderId: "787364486859",
  appId: "1:787364486859:web:73ed9203ddbe10bb5a854e",
  measurementId: "G-WHQ7CV91X0"
};

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            let cardsData = [];
            
            // --- Screen and Element Selectors ---
            const screens = ['login-screen', 'home-screen', 'collection-screen', 'battle-screen', 'deck-builder-screen', 'marketplace-screen', 'wallet-screen', 'lore-screen', 'nfc-screen'].reduce((acc, id) => {
                acc[id] = document.getElementById(id);
                return acc;
            }, {});
            const navMain = document.getElementById('main-nav');
            const navItems = document.querySelectorAll('#main-nav > div > div');
            
            // --- Login Elements ---
            const loginForm = document.getElementById('login-form');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');

            // --- Home Screen Elements ---
            const navBattle = document.getElementById('nav-battle');
            const navDeck = document.getElementById('nav-deck');
            const navMarket = document.getElementById('nav-market');
            const navWallet = document.getElementById('nav-wallet');
            const navLore = document.getElementById('nav-lore');

            // --- Collection Elements ---
            const cardGrid = document.getElementById('card-grid');
            const scanButtonCollection = document.getElementById('scan-button-collection');
            const cardModal = document.getElementById('card-modal');
            const closeModalButton = document.getElementById('close-modal');
            const modalContent = document.getElementById('modal-content');
            const loadingMessage = document.getElementById('loading-message');

            // --- Deck Builder Elements ---
            const cardCollectionDisplay = document.getElementById('card-collection-display');
            const deckArea = document.getElementById('deck-area');
            const deckCount = document.getElementById('deck-count');
            let deck = [];
            const deckLimit = 40;

            // --- NFC Scan Elements ---
            const scanButtonNFC = document.getElementById('scan-button-nfc');
            const messageBox = document.getElementById('messageBox');
            const cardDisplay = document.getElementById('cardDisplay');
            const cardInfo = document.getElementById('cardInfo');
            const serialNumberInput = document.getElementById('serialNumberInput');
            const submitSerialButton = document.getElementById('submitSerialButton');

            // --- Functions ---
            const showScreen = (screenId, navItem) => {
                Object.values(screens).forEach(screen => screen.style.display = 'none');
                screens[screenId].style.display = 'flex';
                
                navItems.forEach(item => item.classList.remove('active-nav', 'opacity-100'));
                if (navItem) {
                    navItem.classList.add('active-nav', 'opacity-100');
                }
            };
            
            const showMessage = (text, type = 'info') => {
                messageBox.textContent = text;
                messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                if (type === 'error') {
                    messageBox.classList.add('bg-red-100', 'text-red-700');
                } else if (type === 'success') {
                    messageBox.classList.add('bg-green-100', 'text-green-700');
                } else {
                    messageBox.classList.add('bg-blue-100', 'text-blue-700');
                }
                setTimeout(() => messageBox.classList.add('hidden'), 5000);
            };

            const fetchCardsFromFirebase = async () => {
                loadingMessage.style.display = 'block';
                try {
                    const cardsCollection = await db.collection('cards').get();
                    cardsData = cardsCollection.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderCardGrid();
                    renderCardCollectionForDeckBuilder();
                } catch (error) {
                    console.error("Error fetching cards: ", error);
                    cardGrid.innerHTML = `<div class="col-span-full text-center text-red-500 mt-8">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÑ‡∏î‡πâ: ${error.message}</div>`;
                } finally {
                    loadingMessage.style.display = 'none';
                }
            };

            const renderCardGrid = () => {
                cardGrid.innerHTML = '';
                if (cardsData.length === 0) {
                    cardGrid.innerHTML = `<div class="col-span-full text-center text-gray-500 mt-8">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏Å‡∏ä‡∏±‡∏ô</div>`;
                    return;
                }
                cardsData.forEach(card => {
                    const cardElement = createCardElement(card, 'collection');
                    cardGrid.appendChild(cardElement);
                });
            };

            const renderCardCollectionForDeckBuilder = () => {
                cardCollectionDisplay.innerHTML = '';
                cardsData.forEach(card => {
                    const cardElement = createCardElement(card, 'deckbuilder');
                    cardCollectionDisplay.appendChild(cardElement);
                });
            };
            
            const createCardElement = (card, type) => {
                const element = document.createElement('div');
                element.className = 'bg-gray-700 rounded-xl shadow-lg overflow-hidden cursor-pointer transform transition-transform hover:scale-105';
                element.innerHTML = `
                    <img src="${card.image_url}" alt="${card.name}" class="w-full h-auto object-cover"/>
                    <div class="p-2 text-center">
                        <h3 class="text-sm font-semibold truncate">${card.name}</h3>
                    </div>
                `;
                if (type === 'collection') {
                    element.addEventListener('click', () => openCardDetails(card));
                } else if (type === 'deckbuilder') {
                    element.setAttribute('draggable', true);
                    element.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('cardId', card.id);
                    });
                }
                return element;
            };

            const openCardDetails = (card) => {
                modalContent.innerHTML = `
                    <h3 class="text-2xl font-bold mb-4 text-yellow-500">${card.name}</h3>
                    <img src="${card.image_url}" alt="${card.name}" class="w-full h-auto mx-auto mb-4 rounded-xl shadow-lg ring-4 ring-amber-500"/>
                    <p class="text-sm text-gray-300 mt-4 mb-4">${card.description}</p>
                    <div class="bg-gray-800 text-white p-4 rounded-xl text-left">
                        <p class="text-sm"><b>‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á:</b> ATT: ${card.stats ? card.stats.attack : 'N/A'}, DEF: ${card.stats ? card.stats.defense : 'N/A'}</p>
                        <p class="text-sm"><b>‡∏£‡∏∞‡∏î‡∏±‡∏ö:</b> ${card.rarity}</p>
                        <p class="text-sm"><b>Token ID:</b> ${card.token_id || 'N/A'}</p>
                    </div>
                `;
                cardModal.style.display = 'flex';
            };
            
            const displayScannedCardData = (data) => {
                cardInfo.innerHTML = '';
                cardDisplay.classList.remove('hidden');
                cardInfo.innerHTML = `
                    <img src="${data.image_url}" alt="${data.name}" class="w-48 h-auto mx-auto mb-4 rounded-xl shadow-md border-4 border-yellow-500"/>
                    <h3 class="text-2xl font-bold mb-2 text-yellow-500">${data.name}</h3>
                    <p class="text-sm text-gray-300 mb-4">${data.description}</p>
                    <div class="bg-gray-700 p-4 rounded-xl text-left shadow-md">
                        <p class="text-sm text-gray-400"><b>‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á:</b> ATT: ${data.stats ? data.stats.attack : 'N/A'}, DEF: ${data.stats ? data.stats.defense : 'N/A'}</p>
                        <p class="text-sm text-gray-400"><b>‡∏£‡∏∞‡∏î‡∏±‡∏ö:</b> ${data.rarity}</p>
                        <p class="text-sm text-gray-400"><b>Token ID:</b> ${data.token_id || 'N/A'}</p>
                    </div>
                `;
                showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            };

            const addCardToDeck = (cardId) => {
                if (deck.length >= deckLimit) {
                    alert('Deck is full!');
                    return;
                }
                const cardToAdd = cardsData.find(c => c.id === cardId);
                if (cardToAdd) {
                    deck.push(cardToAdd);
                    deckCount.textContent = deck.length;
                    const cardElement = createCardElement(cardToAdd, 'deck');
                    deckArea.appendChild(cardElement);
                }
            };
            
            // --- Event Listeners ---
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (usernameInput.value && passwordInput.value) {
                    showScreen('home-screen');
                    navMain.style.display = 'block';
                    document.getElementById('nav-home-main').classList.add('active-nav', 'opacity-100');
                } else {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
                }
            });
            
            // Navigation from Home Screen
            navBattle.addEventListener('click', () => { 
                showScreen('battle-screen'); 
                startGame(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô startGame ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Battle
            });
            navDeck.addEventListener('click', () => { showScreen('deck-builder-screen'); fetchCardsFromFirebase(); });
            navMarket.addEventListener('click', () => showScreen('marketplace-screen'));
            navWallet.addEventListener('click', () => showScreen('wallet-screen'));
            navLore.addEventListener('click', () => showScreen('lore-screen'));

            // Navigation from Main Nav Bar
            document.getElementById('nav-home-main').addEventListener('click', () => { showScreen('home-screen', document.getElementById('nav-home-main')); });
            document.getElementById('nav-collection-main').addEventListener('click', () => { showScreen('collection-screen', document.getElementById('nav-collection-main')); fetchCardsFromFirebase(); });
            document.getElementById('nav-store-main').addEventListener('click', () => { showScreen('marketplace-screen', document.getElementById('nav-store-main')); alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'); });
            document.getElementById('nav-profile-main').addEventListener('click', () => { showScreen('wallet-screen', document.getElementById('nav-profile-main')); alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'); });

            // Collection & NFC
            closeModalButton.addEventListener('click', () => cardModal.style.display = 'none');
            scanButtonCollection.addEventListener('click', () => showScreen('nfc-screen'));

            // NFC & Serial Number Input
            submitSerialButton.addEventListener('click', () => {
                const serialNumber = serialNumberInput.value.trim();
                if (serialNumber) {
                    const foundCard = cardsData.find(card => card.serial_number === serialNumber);
                    if (foundCard) {
                        displayScannedCardData(foundCard);
                    } else {
                        showMessage('‡πÑ‡∏°‡πà‡∏û‡∏ö Serial Number ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'error');
                        cardDisplay.classList.add('hidden');
                    }
                } else {
                    showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Serial Number', 'error');
                }
            });

            scanButtonNFC.addEventListener('click', async () => {
                showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ï‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå', 'info');
                cardDisplay.classList.add('hidden');
                
                if ('NDEFReader' in window) {
                    try {
                        const ndef = new NDEFReader();
                        await ndef.scan();
                        ndef.onreading = event => {
                            const message = event.message;
                            const record = message.records[0];
                            if (record.recordType === 'text') {
                                const textDecoder = new TextDecoder();
                                const serialNumber = textDecoder.decode(record.data);
                                const scannedCard = cardsData.find(card => card.serial_number === serialNumber);
                                if (scannedCard) {
                                    displayScannedCardData(scannedCard);
                                } else {
                                    showMessage('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                                }
                            } else {
                                showMessage('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                            }
                        }
                    } catch (error) {
                        showMessage(`‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                    }
                } else {
                    showMessage('‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Web NFC (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô)', 'error');
                    setTimeout(() => {
                        if (cardsData.length > 0) {
                            const randomCard = cardsData[Math.floor(Math.random() * cardsData.length)];
                            displayScannedCardData(randomCard);
                        } else {
                            showMessage('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô', 'error');
                        }
                    }, 2000);
                }
            });
            
            // Deck Builder Drag & Drop
            deckArea.addEventListener('dragover', (e) => e.preventDefault());
            deckArea.addEventListener('drop', (e) => {
                e.preventDefault();
                const cardId = e.dataTransfer.getData('cardId');
                addCardToDeck(cardId);
            });
            
            // Initial load
            showScreen('login-screen');
            fetchCardsFromFirebase();
            
            // ==========================================================
            // --- GAMEPLAY CODE (FROM PREVIOUS RESPONSE) ---
            // ==========================================================

            // --- Card Data for Gameplay ---
            // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏•‡∏¢‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            const cards = [
                { id: 'c1', name: 'Soldier Spirit', type: 'Spirit', atk: 2, def: 2, cost: 1, rarity: 'Common' },
                { id: 'c2', name: 'Mekong Serpent', type: 'Spirit', atk: 4, def: 3, cost: 2, rarity: 'Rare', ability: 'Passive: +1 ATK to all water Spirits.' },
                { id: 'c3', name: 'Naga Sovereign', type: 'Spirit', atk: 6, def: 5, cost: 3, rarity: 'Legendary' },
                { id: 'v1', name: 'Virtue of Compassion', type: 'Virtue', cost: 1, rarity: 'Uncommon', ability: 'Heal +2 Life to a player.' },
                { id: 'v2', name: 'Virtue of Courage', type: 'Virtue', cost: 1, rarity: 'Rare', ability: 'Give a Spirit +2 ATK for this turn.' },
                { id: 'f1', name: 'Moonlit Field', type: 'Field', cost: 2, rarity: 'Epic', ability: 'Passive: All Spirits get +1 DEF.' },
                { id: 'r1', name: 'Ritual of Binding', type: 'Ritual', cost: 2, rarity: 'Uncommon', ability: 'Bind an opponent Spirit. It cannot attack for 1 turn.' },
                { id: 'c1-2', name: 'Soldier Spirit', type: 'Spirit', atk: 2, def: 2, cost: 1, rarity: 'Common' },
                { id: 'c1-3', name: 'Soldier Spirit', type: 'Spirit', atk: 2, def: 2, cost: 1, rarity: 'Common' },
                { id: 'c2-2', name: 'Mekong Serpent', type: 'Spirit', atk: 4, def: 3, cost: 2, rarity: 'Rare', ability: 'Passive: +1 ATK to all water Spirits.' },
                { id: 'c2-3', name: 'Mekong Serpent', type: 'Spirit', atk: 4, def: 3, cost: 2, rarity: 'Rare', ability: 'Passive: +1 ATK to all water Spirits.' },
                { id: 'c3-2', name: 'Naga Sovereign', type: 'Spirit', atk: 6, def: 5, cost: 3, rarity: 'Legendary' },
                { id: 'v1-2', name: 'Virtue of Compassion', type: 'Virtue', cost: 1, rarity: 'Uncommon', ability: 'Heal +2 Life to a player.' },
                { id: 'v1-3', name: 'Virtue of Compassion', type: 'Virtue', cost: 1, rarity: 'Uncommon', ability: 'Heal +2 Life to a player.' },
                { id: 'v2-2', name: 'Virtue of Courage', type: 'Virtue', cost: 1, rarity: 'Rare', ability: 'Give a Spirit +2 ATK for this turn.' },
                { id: 'f1-2', name: 'Moonlit Field', type: 'Field', cost: 2, rarity: 'Epic', ability: 'Passive: All Spirits get +1 DEF.' },
                { id: 'r1-2', name: 'Ritual of Binding', type: 'Ritual', cost: 2, rarity: 'Uncommon', ability: 'Bind an opponent Spirit. It cannot attack for 1 turn.' },
                { id: 'c4', name: 'Monk Warrior', type: 'Spirit', atk: 3, def: 3, cost: 2, rarity: 'Common' },
                { id: 'c5', name: 'Sacred Tiger', type: 'Spirit', atk: 5, def: 4, cost: 3, rarity: 'Rare' },
                { id: 'c6', name: 'Celestial Phoenix', type: 'Spirit', atk: 7, def: 6, cost: 4, rarity: 'Legendary' },
                { id: 'v3', name: 'Virtue of Justice', type: 'Virtue', cost: 2, rarity: 'Uncommon', ability: 'Destroy a Spirit with ATK 3 or less.' },
                { id: 'f2', name: 'Cosmic Battlefield', type: 'Field', cost: 3, rarity: 'Epic', ability: 'Passive: All Spirits get +1 ATK.' },
            ];
            
            // --- Game State ---
            let deckA = [];
            let deckB = [];
            let playerHand = [];
            let opponentHand = [];
            let playerBoard = [];
            let opponentBoard = [];
            let playerLife = 15;
            let opponentLife = 15;
            let currentPlayer = 'A';
            let playerEnergy = 0;
            let opponentEnergy = 0;
            let logElement = document.getElementById('log');

            // --- UI Elements (Gameplay) ---
            const playerLifeEl = document.getElementById('player-life');
            const opponentLifeEl = document.getElementById('opponent-life');
            const playerLifeBarEl = document.getElementById('player-life-bar');
            const opponentLifeBarEl = document.getElementById('opponent-life-bar');
            const playerHandEl = document.getElementById('player-hand');
            const playerBoardEl = document.getElementById('player-board');
            const opponentBoardEl = document.getElementById('opponent-board');
            const gameStatusEl = document.getElementById('game-status');
            const endTurnBtn = document.getElementById('end-turn-btn');

            // --- Gameplay Functions ---
            const shuffleDeck = (deck) => {
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
            };
            
            const createGameplayCardElement = (card, location, owner = 'player') => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.innerHTML = `
                    <h4>${card.name}</h4>
                    <p class="stats">${card.type === 'Spirit' ? `ATK: ${card.atk} / DEF: ${card.def}` : ''}</p>
                    <p class="stats">${card.ability ? card.ability : ''}</p>
                `;
                if (location === 'hand') {
                    cardEl.onclick = () => playCard(card);
                }
                if (location === 'board' && owner === 'player') {
                    cardEl.onclick = () => selectAttacker(card);
                }
                return cardEl;
            };

            const updateGameplayUI = () => {
                playerLifeEl.textContent = playerLife;
                opponentLifeEl.textContent = opponentLife;
                playerLifeBarEl.style.width = (playerLife / 15) * 100 + '%';
                opponentLifeBarEl.style.width = (opponentLife / 15) * 100 + '%';
                gameStatusEl.textContent = `Turn: Player ${currentPlayer}`;
                playerHandEl.innerHTML = '';
                playerBoardEl.innerHTML = '';
                opponentBoardEl.innerHTML = '';

                playerHand.forEach(card => playerHandEl.appendChild(createGameplayCardElement(card, 'hand')));
                playerBoard.forEach(card => playerBoardEl.appendChild(createGameplayCardElement(card, 'board')));
                opponentBoard.forEach(card => opponentBoardEl.appendChild(createGameplayCardElement(card, 'board', 'opponent')));
            };

            const log = (message) => {
                const p = document.createElement('p');
                p.textContent = message;
                logElement.appendChild(p);
                logElement.scrollTop = logElement.scrollHeight;
            };

            const checkWinCondition = () => {
                if (playerLife <= 0) {
                    gameStatusEl.textContent = 'Player B Wins!';
                    endTurnBtn.disabled = true;
                    log('Player B has won the game!');
                    return true;
                }
                if (opponentLife <= 0) {
                    gameStatusEl.textContent = 'Player A Wins!';
                    endTurnBtn.disabled = true;
                    log('Player A has won the game!');
                    return true;
                }
                return false;
            };

            window.startGame = () => {
                // Reset game state
                deckA = [...cards];
                deckB = [...cards];
                playerHand = [];
                opponentHand = [];
                playerBoard = [];
                opponentBoard = [];
                playerLife = 15;
                opponentLife = 15;
                currentPlayer = 'A';
                logElement.innerHTML = '<p>--- Game Log ---</p>';
                endTurnBtn.disabled = false;
                
                // Setup & Shuffle Decks
                shuffleDeck(deckA);
                shuffleDeck(deckB);
                
                // Initial Draw
                for (let i = 0; i < 5; i++) {
                    playerHand.push(deckA.pop());
                    opponentHand.push(deckB.pop());
                }
                
                log('Game Started! Player A begins.');
                startTurn();
            };

            const startTurn = () => {
                log(`--- Player ${currentPlayer}'s Turn ---`);
                // Draw Phase
                if (currentPlayer === 'A') {
                    if (deckA.length > 0) {
                        playerHand.push(deckA.pop());
                    }
                } else {
                    if (deckB.length > 0) {
                        opponentHand.push(deckB.pop());
                    }
                }
                updateGameplayUI();
            };
            
            const playCard = (card) => {
                if (currentPlayer !== 'A') return;
                
                playerHand = playerHand.filter(c => c.id !== card.id);
                
                if (card.type === 'Spirit') {
                    playerBoard.push(card);
                    log(`Player A played "${card.name}" to the board.`);
                } else if (card.type === 'Virtue') {
                    playerLife += 2;
                    log(`Player A used "${card.name}" and healed 2 life.`);
                } else if (card.type === 'Ritual') {
                    if (opponentBoard.length > 0) {
                        const targetIndex = Math.floor(Math.random() * opponentBoard.length);
                        const destroyedCard = opponentBoard.splice(targetIndex, 1)[0];
                        log(`Player A used "${card.name}" and destroyed "${destroyedCard.name}".`);
                    } else {
                        log(`Player A used "${card.name}" but there were no Spirits to destroy.`);
                    }
                }
                
                updateGameplayUI();
            };
            
            let selectedAttacker = null;

            const selectAttacker = (card) => {
                if (currentPlayer !== 'A') return;
                
                if (selectedAttacker) {
                    selectedAttacker = null;
                    const activeCard = document.querySelector('.card.active');
                    if (activeCard) activeCard.classList.remove('active');
                    log("Deselected attacker.");
                } else {
                    selectedAttacker = card;
                    const cardElements = document.querySelectorAll('#player-board .card');
                    cardElements.forEach(el => {
                        if (el.querySelector('h4').textContent === card.name) {
                            el.classList.add('active');
                        }
                    });
                    log(`Selected "${card.name}" to attack.`);
                    attackPhase();
                }
            };
            
            const attackPhase = () => {
                if (selectedAttacker) {
                    log(`Player A's "${selectedAttacker.name}" attacks!`);
                    
                    const damage = selectedAttacker.atk;
                    opponentLife -= damage;
                    log(`Player B takes ${damage} damage. Life left: ${opponentLife}`);
                    
                    selectedAttacker = null;
                    const activeCard = document.querySelector('.card.active');
                    if (activeCard) activeCard.classList.remove('active');
                    
                    if (checkWinCondition()) return;
                }
                updateGameplayUI();
            };

            const opponentTurn = () => {
                log('--- Player B\'s Turn ---');
                
                const cardToPlay = opponentHand.find(c => c.type === 'Spirit');
                if (cardToPlay) {
                    opponentHand = opponentHand.filter(c => c.id !== cardToPlay.id);
                    opponentBoard.push(cardToPlay);
                    log(`Player B plays "${cardToPlay.name}".`);
                }
                
                setTimeout(() => {
                    opponentBoard.forEach(spirit => {
                        log(`Player B's "${spirit.name}" attacks!`);
                        playerLife -= spirit.atk;
                        log(`Player A takes ${spirit.atk} damage. Life left: ${playerLife}`);
                    });
                    
                    if (checkWinCondition()) return;
                    
                    currentPlayer = 'A';
                    log('Player B ends turn.');
                    startTurn();
                }, 1000);
            };

            endTurnBtn.onclick = () => {
                if (currentPlayer === 'A') {
                    currentPlayer = 'B';
                    log('Player A ends turn.');
                    opponentTurn();
                }
            };

            // ==========================================================
            // --- END OF GAMEPLAY CODE ---
            // ==========================================================
        });
    </script>
</body>
</html>

