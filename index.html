<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardVerse - Phygital Game Card</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .logo-text {
            font-size: 3rem;
            font-weight: 700;
            color: #ecf0f1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 2px;
        }
        .btn-social {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-social:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .input-field:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div id="login-screen" class="bg-white p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-md mx-4 sm:mx-6 md:mx-auto text-center" style="display: block;">
        <div class="mb-8">
            <div class="w-24 h-24 bg-gray-200 rounded-full mx-auto flex items-center justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 12l10 10 10-10L12 2zm0 18.83L3.17 12 12 3.17 20.83 12 12 20.83zM12 14c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
            </div>
            <h1 class="logo-text text-gray-800">CardVerse</h1>
            <p class="text-gray-500 mt-2">Phygital Game Card</p>
        </div>
        <div class="space-y-4 mb-8">
            <button class="btn-social flex items-center justify-center w-full py-3 px-4 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-xl shadow-md">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21.35 12.04c0-.79-.07-1.54-.18-2.29H12v4.32h4.94a5.15 5.15 0 01-2.23 3.37v2.8h3.6c2.1-1.94 3.32-4.8 3.32-8.3z"/><path d="M12 20.01c-3.14 0-5.83-1.74-7.29-4.32l3.6-2.8c.84.58 1.96.93 3.69.93 1.83 0 3.35-.6 4.62-1.63L18.4 17.5c-1.3 1.25-3.08 2.01-5.11 2.01z"/><path d="M4.71 12c0-1.02.2-1.98.54-2.86l-3.6-2.8c-.85 1.77-1.33 3.79-1.33 5.66s.48 3.89 1.33 5.66l3.6-2.8c-.34-.88-.54-1.84-.54-2.86z"/><path d="M12 4.01c1.92 0 3.53.64 4.62 1.63L20.21 2c-1.26-1.18-2.94-1.9-4.9-1.9-2.73 0-5.13 1.08-6.93 2.86l3.6 2.8c.95-.58 2.07-.93 3.53-.93z"/></svg>
                เข้าสู่ระบบด้วย Google
            </button>
            <button class="btn-social flex items-center justify-center w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-md">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M22.675 0H1.325C.593 0 0 .593 0 1.325v21.35C0 23.407.593 24 1.325 24h11.233V14.734h-3.834v-4.42h3.834V7.237c0-3.805 2.327-5.875 5.705-5.875 1.624 0 3.02.12 3.424.175v3.944l-2.336.001c-1.835 0-2.187.873-2.187 2.152v2.812h4.373l-.57 4.42h-3.803V24h6.006c.732 0 1.325-.593 1.325-1.325V1.325C24 .593 23.407 0 22.675 0z"/></svg>
                เข้าสู่ระบบด้วย Facebook
            </button>
        </div>
        <div class="relative flex items-center mb-6">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="flex-shrink mx-4 text-gray-400 text-sm">หรือ</span>
            <div class="flex-grow border-t border-gray-300"></div>
        </div>
        <form id="login-form">
            <div class="space-y-4">
                <input type="text" id="username" placeholder="ชื่อผู้ใช้" class="input-field w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none">
                <input type="password" id="password" placeholder="รหัสผ่าน" class="input-field w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none">
            </div>
            <button type="submit" class="w-full mt-6 py-3 px-4 bg-gray-800 hover:bg-gray-900 text-white font-semibold rounded-xl shadow-md">
                เข้าสู่ระบบ
            </button>
        </form>
        <div class="mt-6 text-gray-500 text-sm">
            <span>ยังไม่มีบัญชีใช่ไหม?</span>
            <a href="#" class="text-blue-500 hover:text-blue-600 font-semibold">ลงทะเบียนที่นี่</a>
        </div>
    </div>

    <div id="collection-screen" class="bg-gray-100 min-h-screen flex flex-col font-inter w-full" style="display: none;">
        <header class="p-4 bg-gray-900 text-white shadow-lg text-center">
            <h1 class="text-xl font-bold">คอลเล็กชันของฉัน</h1>
        </header>
        <main id="card-grid" class="flex-grow p-4 pb-20 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            <div id="loading-message" class="col-span-full text-center text-gray-500 mt-8">กำลังโหลดข้อมูลการ์ด...</div>
        </main>
        <button id="scan-button-collection" class="fixed bottom-24 right-4 z-50 p-4 bg-gray-900 text-white rounded-full shadow-2xl flex items-center justify-center transform transition-transform hover:scale-110">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scan"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M17 21h2a2 2 0 0 0 2-2v-2"/><path d="M3 17v2a2 2 0 0 0 2 2h2"/></svg>
        </button>
        <div id="card-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50" style="display: none;">
            <div class="bg-white p-6 rounded-2xl shadow-2xl w-full max-w-sm relative">
                <button id="close-modal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-900">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
                <div id="modal-content" class="text-center">
                    </div>
            </div>
        </div>
        <nav class="fixed bottom-0 left-0 right-0 bg-gray-900 shadow-2xl z-40">
            <div class="flex justify-around items-center h-16">
                <div id="nav-home" class="flex flex-col items-center text-white opacity-50 cursor-pointer hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    <span class="text-xs mt-1">หน้าหลัก</span>
                </div>
                <div id="nav-collection" class="flex flex-col items-center text-white cursor-pointer hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-grid"><rect width="18" height="18" x="3" y="3" rx="2"/></svg>
                    <span class="text-xs mt-1 font-semibold">คอลเล็กชัน</span>
                </div>
                <div id="nav-store" class="flex flex-col items-center text-white opacity-50 cursor-pointer hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-store"><path d="m14 16v-4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v4"/><path d="M22 7H2"/><path d="M22 13H2"/><path d="M12 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/><path d="M12 3v4a3 3 0 0 0-3 3v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2a3 3 0 0 0-3-3V3"/></svg>
                    <span class="text-xs mt-1">ตลาดซื้อขาย</span>
                </div>
                <div id="nav-profile" class="flex flex-col items-center text-white opacity-50 cursor-pointer hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span class="text-xs mt-1">โปรไฟล์</span>
                </div>
            </div>
        </nav>
    </div>

    <div id="nfc-screen" class="flex items-center justify-center min-h-screen p-4 w-full" style="display: none;">
        <div class="bg-white p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-lg text-center space-y-6">
            <h1 class="text-3xl font-bold text-gray-800">CardVerse PoC: ทดสอบระบบ NFC</h1>
            <p class="text-gray-600">กดปุ่มด้านล่างเพื่อเริ่มสแกนการ์ดจริงด้วยชิป NFC</p>
            <button id="scan-button-nfc" class="w-full py-4 px-6 bg-gray-900 text-white font-semibold rounded-xl shadow-lg hover:bg-gray-700 transition-colors">
                แตะเพื่อสแกนการ์ด
            </button>
            <div id="messageBox" class="hidden p-4 rounded-xl text-center text-sm font-medium" role="alert"></div>
            <div id="cardDisplay" class="hidden p-6 bg-gray-100 rounded-xl text-left border-2 border-dashed border-gray-300">
                <h2 class="text-xl font-bold text-gray-800 mb-2">ข้อมูลการ์ดที่สแกนได้</h2>
                <div id="cardInfo" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCef_Xm2vxmaLuZodymWb3tV4mbETvASgw",
  authDomain: "cardverse-mvp.firebaseapp.com",
  projectId: "cardverse-mvp",
  storageBucket: "cardverse-mvp.firebasestorage.app",
  messagingSenderId: "787364486859",
  appId: "1:787364486859:web:73ed9203ddbe10bb5a854e",
  measurementId: "G-WHQ7CV91X0"
};

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            let cardsData = []; // สร้างตัวแปร global เพื่อเก็บข้อมูลการ์ดที่ดึงมาแล้ว

            // --- Page Elements ---
            const loginScreen = document.getElementById('login-screen');
            const collectionScreen = document.getElementById('collection-screen');
            const nfcScreen = document.getElementById('nfc-screen');

            // Login Page
            const loginForm = document.getElementById('login-form');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');

            // Collection Page
            const cardGrid = document.getElementById('card-grid');
            const scanButtonCollection = document.getElementById('scan-button-collection');
            const cardModal = document.getElementById('card-modal');
            const closeModalButton = document.getElementById('close-modal');
            const modalContent = document.getElementById('modal-content');
            const loadingMessage = document.getElementById('loading-message');

            // NFC Scan Page
            const scanButtonNFC = document.getElementById('scan-button-nfc');
            const messageBox = document.getElementById('messageBox');
            const cardDisplay = document.getElementById('cardDisplay');
            const cardInfo = document.getElementById('cardInfo');

            // Navigation
            const navHome = document.getElementById('nav-home');
            const navCollection = document.getElementById('nav-collection');
            const navStore = document.getElementById('nav-store');
            const navProfile = document.getElementById('nav-profile');

            // --- Functions ---
            const showScreen = (screenToShow) => {
                loginScreen.style.display = 'none';
                collectionScreen.style.display = 'none';
                nfcScreen.style.display = 'none';
                screenToShow.style.display = 'flex';
            };

            const fetchCardsFromFirebase = async () => {
                loadingMessage.style.display = 'block';
                try {
                    const cardsCollection = await db.collection('cards').get();
                    cardsData = cardsCollection.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderCardGrid();
                } catch (error) {
                    console.error("Error fetching cards: ", error);
                    cardGrid.innerHTML = `<div class="col-span-full text-center text-red-500 mt-8">ไม่สามารถดึงข้อมูลการ์ดได้: ${error.message}</div>`;
                } finally {
                    loadingMessage.style.display = 'none';
                }
            };

            const renderCardGrid = () => {
                cardGrid.innerHTML = '';
                if (cardsData.length === 0) {
                    cardGrid.innerHTML = `<div class="col-span-full text-center text-gray-500 mt-8">ไม่พบข้อมูลการ์ดในคอลเล็กชัน</div>`;
                    return;
                }
                cardsData.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer transform transition-transform hover:scale-105';
                    cardElement.innerHTML = `
                        <img src="${card.image_url}" alt="${card.name}" class="w-full h-auto object-cover"/>
                        <div class="p-2 text-center">
                            <h3 class="text-sm font-semibold truncate">${card.name}</h3>
                        </div>
                    `;
                    cardElement.addEventListener('click', () => openCardDetails(card));
                    cardGrid.appendChild(cardElement);
                });
            };

            const openCardDetails = (card) => {
                modalContent.innerHTML = `
                    <img src="${card.image_url}" alt="${card.name}" class="w-48 h-auto mx-auto mb-4 rounded-xl shadow-md"/>
                    <h3 class="text-2xl font-bold mb-2">${card.name}</h3>
                    <p class="text-sm text-gray-600 mb-4">${card.description}</p>
                    <div class="bg-gray-100 p-4 rounded-xl text-left">
                        <p class="text-sm"><b>ค่าพลัง:</b> ${stats}</p>
                        <p class="text-sm"><b>ระดับ:</b> ${card.rarity}</p>
                        <p class="text-sm"><b>Token ID:</b> ${card.tokenId}</p>
                    </div>
                `;
                cardModal.style.display = 'flex';
            };

            const showMessage = (text, type = 'info') => {
                messageBox.textContent = text;
                messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                if (type === 'error') {
                    messageBox.classList.add('bg-red-100', 'text-red-700');
                } else if (type === 'success') {
                    messageBox.classList.add('bg-green-100', 'text-green-700');
                } else {
                    messageBox.classList.add('bg-blue-100', 'text-blue-700');
                }
            };

            const displayScannedCardData = (data) => {
                cardInfo.innerHTML = '';
                cardDisplay.classList.remove('hidden');
                cardInfo.innerHTML += `<p class="text-lg font-semibold">ชื่อการ์ด: <span class="font-normal">${data.name}</span></p>`;
                cardInfo.innerHTML += `<p class="text-lg font-semibold">รายละเอียด: <span class="font-normal">${data.description}</span></p>`;
                cardInfo.innerHTML += `<p class="text-lg font-semibold">ค่าพลัง: <span class="font-normal">${data.power}</span></p>`;
                cardInfo.innerHTML += `<p class="text-lg font-semibold">ระดับ: <span class="font-normal">${data.rarity}</span></p>`;
                cardInfo.innerHTML += `<p class="text-lg font-semibold">สถานะการเป็นเจ้าของ (Token ID): <span class="font-normal">${data.tokenId}</span></p>`;
                showMessage('สแกนสำเร็จ!', 'success');
            };

            // --- Event Listeners ---
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                // Simulate login
                if (usernameInput.value && passwordInput.value) {
                    showScreen(collectionScreen);
                    fetchCardsFromFirebase();
                } else {
                    alert('กรุณากรอกชื่อผู้ใช้และรหัสผ่าน');
                }
            });

            closeModalButton.addEventListener('click', () => {
                cardModal.style.display = 'none';
            });

            scanButtonCollection.addEventListener('click', () => {
                showScreen(nfcScreen);
            });

            scanButtonNFC.addEventListener('click', () => {
                showMessage('กำลังสแกนการ์ด... กรุณาแตะการ์ดที่ด้านหลังอุปกรณ์', 'info');
                cardDisplay.classList.add('hidden');
                cardInfo.innerHTML = '';
                
                setTimeout(() => {
                    // Simulate a successful scan by picking a random card from the fetched data
                    if (cardsData.length > 0) {
                        const randomCard = cardsData[Math.floor(Math.random() * cardsData.length)];
                        displayScannedCardData(randomCard);
                    } else {
                        showMessage('ไม่พบข้อมูลการ์ดสำหรับสแกน', 'error');
                    }
                }, 2000); // 2-second delay
            });

            // Navigation
            navCollection.addEventListener('click', () => {
                showScreen(collectionScreen);
                fetchCardsFromFirebase();
            });
            navHome.addEventListener('click', () => { showScreen(collectionScreen); fetchCardsFromFirebase(); }); // For demo, Home button goes to collection
            navStore.addEventListener('click', () => alert('ฟีเจอร์นี้ยังไม่เปิดใช้งาน'));
            navProfile.addEventListener('click', () => alert('ฟีเจอร์นี้ยังไม่เปิดใช้งาน'));
        });
    </script>
</body>
</html>
